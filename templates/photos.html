{% extends "base.html" %}

{% block content_wrapper_class %}content-wrapper-wide{% endblock %}
{% set active_menu_item = 'browser' %}
{% set subheader = user.email + "'s media" %}
{% set months = {'01': 'January', '02': 'February', '03': 'March', '04': 'April',
                 '05': 'May', '06': 'June', '07': 'July', '08': 'August',
                 '09': 'September', '10': 'October', '11': 'November',
                 '12': 'December'} %}
{% block content %}
    {% if mediaitems %}
        {% if total_pages > 1 %}
            {% include 'paginator.html' %}
        {% endif %}
        <div class="mediaitems-container">
            {% set active_date = {'date': ''} %}
            {% for mediaitem in mediaitems %}
                {% set current_date = mediaitem.creation_time[0:10] %}
                {% if current_date != active_date['date'] %}
                    {% if active_date['date'] != '' %}
            </div>
                    {% endif %}
                    {% if active_date.update({'date': current_date}) %}{% endif %}
                    {% set date_parts = current_date.split('-') %}
            <div class="date-container">
                {{ months.get(date_parts[1], 'Unknown') }}
                {{ date_parts[2] }},
                {{ date_parts[0] }}
                <span>({{ current_date }})</span>
            </div>
            <div class="images-container">
                {% endif %}
                <div class="image-container" style="height:160px;width:{{ (160*(mediaitem.width or 1)/(mediaitem.height or 1))|int() }}px;background-image:url({{ url_for('library_thumbnail', user_id=user.id, mediaitem_id=mediaitem.id) }});">
                    <a href="{{ url_for('library_mediaitem', user_id=user.id, mediaitem_id=mediaitem.id) }}">
                    {% if mediaitem.type == 'video' %}
                        <span><i class="icon icon-play"></i></span>
                    {% endif %}
                    </a>
                </div>
            {% endfor %}
            {% if active_date['date'] != '' %}
            </div>
            {% endif %}
        </div>
        {% if total_pages > 1 %}
            {% include 'paginator.html' %}
        {% endif %}
        <script>
            var inputs = document.getElementsByClassName('paginator-current-page')
            for (var i=0; i<inputs.length; i++) {
                inputs[i].addEventListener("keyup", (event) => {
                    var input = event.target || event.srcElement;
                    var max_value = parseInt(input.getAttribute('max-value'))
                    var value_str = input.value;
                    if (isNaN(value_str) || isNaN(parseInt(value_str)) && value_str != '') {
                        input.value = 1
                        return
                    }
                    value = parseInt(value_str)
                    if (value < 1) {
                        value = 1
                        input.value = 1
                    } else if (value > max_value) {
                        value = max_value
                        input.value = max_value
                    }
                    if (event.keyCode == 10 || event.keyCode == 13) {
                        window.location.href = "{{ url_for('user_mediaitems', user_id=user.id) }}/" + value;
                    }
                });
            }
        </script>
    {% else %}
    <div class="users-container">
        <p>No media items found. Seems this user never created backup. ;-)</p>
    </div>
    {% endif %}
{% endblock %}